"use strict";(self.webpackChunkcapstone2_kanban=self.webpackChunkcapstone2_kanban||[]).push([[345,988],{224:(e,t,n)=>{n.d(t,{RV:()=>o,WI:()=>a,fu:()=>l,hJ:()=>i,li:()=>r,nN:()=>s});const a=async e=>{try{const t=await fetch(e,{method:"GET"});return await t.json()}catch(e){throw console.warn("getAnime fetch failed",e),e}};async function i(e,t=3e3){const n=new AbortController,a=setTimeout((()=>n.abort()),t);try{const t=await fetch(e,{method:"GET",signal:n.signal});return clearTimeout(a),t.ok}catch(e){return clearTimeout(a),!1}}const s=async e=>await fetch(e).then((e=>e.json()));async function r(e){return await fetch(e).then((e=>e.json()))}const o=async(e,t,n,a)=>{await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_id:e,username:t,comment:n})})},l=async(e,t)=>{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_id:e})})}},561:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(224);class i{constructor(){this.animes=[]}static commentKey(e,t,n,a){return`${e}::${(t||"").toString().trim()}::${(n||"").toString().trim()}::${(a||"").toString().trim()}`}async loadData(e,t,n,s={}){!0===s.append||(e&&e.innerHTML&&(e.innerHTML=""),this.animes=[]);let r=[];try{r=await(0,a.WI)(t),r&&r.data&&Array.isArray(r.data)&&(r=r.data),Array.isArray(r)||(r=[])}catch(e){console.warn("Failed to fetch anime list",e),r=[]}r&&0!==r.length||(r=[{title:"Sample: Skybound Saga",images:{jpg:{image_url:"./icons&imgs/dynasty-logo.svg"}},synopsis:"A thrilling adventure about sky pirates and ancient machines.",genres:[{name:"Action"},{name:"Adventure"}],rank:null},{title:"Sample: Night Blossom",images:{jpg:{image_url:"./icons&imgs/dynasty-logo.svg"}},synopsis:"A quiet story of love and secrets in a coastal town.",genres:[{name:"Drama"},{name:"Romance"}],rank:null}]);let o=[];try{o=await(0,a.nN)(n),Array.isArray(o)||(o=[])}catch(e){console.warn("Failed to fetch likes",e),o=[]}const l=new Map;o.forEach((e=>{const t=Number(e.item_id);Number.isNaN(t)||l.set(t,e.likes)}));const c=document.createDocumentFragment();return r.forEach(((e,t)=>{if(!e)return;const n=this.animes.length+t,a=function(e){return e?{title:e.title||e.titles&&e.titles[0]&&e.titles[0].title||"Untitled",image:e.images&&e.images.jpg&&(e.images.jpg.image_url||e.images.jpg.large_image_url)||e.image||"./icons&imgs/dynasty-logo.svg",imageHigh:e.images&&e.images.jpg&&(e.images.jpg.large_image_url||e.images.jpg.image_url)||e.image||"./icons&imgs/dynasty-logo.svg",synopsis:e.synopsis||e.background||"",genres:e.genres&&e.genres.map((e=>e.name))||e.genres_list&&e.genres_list.map((e=>e.name))||[],ranking:e.rank||e.ranking||null,mal_id:e.mal_id||e.id||null,score:e.score||null,episodes:e.episodes||null,trailer:e.trailer&&(e.trailer.youtube_id?`https://www.youtube.com/watch?v=${e.trailer.youtube_id}`:e.trailer.url)||null}:null}(e)||{},r=i.sanitizeSynopsis(a.synopsis||""),o=document.createElement("div");o.className="movie-card bg-gray-800 rounded-lg shadow-xl overflow-hidden transform hover:-translate-y-2 transition duration-300",s&&s.hidden&&o.classList.add("hidden-by-default"),o.dataset.id=n,o.dataset.title=(e.title||"").toLowerCase();const m=l.get(n)||0,d=(g=a.image,(p=a.imageHigh)&&p!==g?`${g} 400w, ${p} 1200w`:null),u=d?`srcset="${d}" sizes="(max-width:800px)400px, 1200px"`:"";var g,p;o.innerHTML=`\n        <div class="card-inner">\n            <div class="poster-wrap">\n            <img loading="lazy" decoding="async" class="poster" src="${a.image}" ${u} alt="${a.title}">\n            <div class="play-overlay" aria-hidden="true"><i class="fas fa-play"></i></div>\n            <div class="badge">${a.ranking?`#${a.ranking}`:"NEW"}</div>\n          </div>\n          <div class="meta">\n            <h3 class="title">${a.title}</h3>\n            <div class="card-meta">\n              <div class="sub">${a.genres?a.genres.join(", ").slice(0,40):""}</div>\n              <div class="meta-right" style="margin-left:auto; text-align:right; font-weight:700">${a.score?`★ ${a.score}`:""}${a.episodes?` · ${a.episodes} ep`:""}</div>\n              <div class="likes"><span id="span-${n}">${m}</span> <i class="fas fa-heart" style="opacity:0.6;margin-left:6px"></i></div>\n            </div>\n            <div class="info-strip">${r?r.length>70?r.slice(0,70)+"…":r:""}</div>\n            <div class="actions">\n              <button class="icon-btn fav-btn" aria-label="favorite"><i class="fas fa-bookmark"></i></button>\n              <button class="icon-btn like-btn" aria-label="like"><i class="fas fa-heart"></i></button>\n              <button class="icon-btn comment-btn" aria-label="comments"><i class="fas fa-comment"></i></button>\n            </div>\n          </div>\n        </div>`,c.appendChild(o);const h={id:n,title:a.title,synopsis:r,image:a.image,likes:m,mal_id:a.mal_id,score:a.score,episodes:a.episodes,trailer:a.trailer,comments:0};this.animes.push(h),this.itemsCounter()})),e&&c.childNodes&&c.childNodes.length&&e.appendChild(c),r.length}static sanitizeSynopsis(e){if(!e)return"";let t=e.split(/\r?\n/).map((e=>e.trim())).filter((e=>{const t=e.toLowerCase();return!(!e||t.startsWith("written by")||t.startsWith("by ")||t.startsWith("source:")||/^—|^\u2014/.test(e))})).join(" ");return t=t.replace(/\s*written by[\s\S]*$/i,""),t.trim()}increaseLikes(e){const t=document.getElementById(`span-${e}`);this.animes[e].likes+=1,t.innerText=this.animes[e].likes}itemsCounter(){document.getElementById("animesNum").innerText=this.animes.length}async loadModalInfo(e,t){const n=this.animes[e],s=document.getElementById("commentsNumber");s&&(s.innerText=this.animes[e].comments||0);const r=document.getElementById("animeDescription"),o=n.synopsis||"No description provided.";r&&this.renderWithReadMore(r,o,400),document.getElementById("modal-title").innerText=n.title,document.getElementById("modal-image").setAttribute("src",n.image);const l=document.getElementById("trailer-wrap");if(l&&l.parentNode&&l.parentNode.removeChild(l),n.trailer){const e=document.querySelector(".modal-inner .right");if(e){const t=document.createElement("div");t.id="trailer-wrap",t.className="trailer-wrap";let a=null;try{const e=new URL(n.trailer);e.hostname.includes("youtube.com")&&(a=e.searchParams.get("v")),e.hostname.includes("youtu.be")&&(a=e.pathname.replace(/^\//,""))}catch(e){const t=String(n.trailer).match(/[?&]v=([^&]+)/);t&&(a=t[1]);const i=String(n.trailer).match(/youtu\.be\/(.+)$/);!a&&i&&(a=i[1])}if(a){const e=document.createElement("iframe");e.setAttribute("src",`https://www.youtube.com/embed/${a}?rel=0`),e.setAttribute("title",`${n.title} — trailer`),e.setAttribute("frameborder","0"),e.setAttribute("allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"),e.setAttribute("allowfullscreen",""),e.className="trailer-iframe",t.appendChild(e)}else{const e=document.createElement("a");e.id="watch-trailer",e.className="cta",e.href=n.trailer,e.target="_blank",e.rel="noopener noreferrer",e.innerText="Watch trailer",t.appendChild(e)}e.insertBefore(t,e.querySelector("div"))}}const c=document.getElementById("modal-image");c&&(c.complete?c.classList.add("loaded"):c.addEventListener("load",(()=>c.classList.add("loaded"))));const m=document.getElementById("sticker-badge");m&&(m.innerText=n.title.length>28?`${n.title.slice(0,25)}…`:n.title);const d=document.getElementById("comments");d.dataset.id=e,d.innerHTML="";const u=`${t}?item_id=${e}`,g=await(0,a.li)(u);if(Array.isArray(g)){const t=JSON.parse(localStorage.getItem("deletedComments")||"[]"),n=g.filter((n=>{const a=i.commentKey(e,n.username,n.creation_date,n.comment);return!t.includes(a)}));this.animes[e].comments=n.length,s&&(s.innerText=this.animes[e].comments),n.forEach((t=>{this.addComment(e,t.username,t.creation_date,t.comment)}))}}renderWithReadMore(e,t,n=300){e.innerHTML="";const a=t.slice(0,n),i=t.length>n,s=document.createElement("div");if(s.className="anime-desc-body",s.textContent=i?a+"…":t,i||s.classList.add("expanded"),e.appendChild(s),i){const n=document.createElement("button");n.type="button",n.className="read-more-btn",n.setAttribute("aria-expanded","false"),n.textContent="Read more",n.addEventListener("click",(()=>{"true"===n.getAttribute("aria-expanded")?(s.textContent=a+"…",s.classList.remove("expanded"),n.textContent="Read more",n.setAttribute("aria-expanded","false")):(s.textContent=t,s.classList.add("expanded"),n.textContent="Show less",n.setAttribute("aria-expanded","true"));const i=e.querySelector("[aria-live]");i&&(i.textContent=n.textContent+" description")})),e.appendChild(n)}}addComment(e,t,n,a){const s=document.createElement("div"),r=document.getElementById("comments")||document.querySelector(".comments")||(()=>{const e=document.createElement("div");return e.id="comments",document.body.appendChild(e),e})(),o=document.getElementById("commentsNumber");s.className="comment",s.setAttribute("data-author",t),s.innerHTML=`\n      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:8px">\n        <div style="display:flex; gap:12px; align-items:center">\n          <div class="avatar">${t&&t[0]?t[0].toUpperCase():"U"}</div>\n          <div>\n            <div class="comment-meta"><strong>${t}</strong> <span style="color:var(--muted); font-size:0.85rem; margin-left:8px">${n}</span></div>\n          </div>\n        </div>\n        <button class="comment-close" aria-label="Delete comment" title="Delete comment">&times;</button>\n      </div>\n      <p>${a}</p>\n    `,this.animes[e].comments+=1,o.innerText=this.animes[e].comments,r.appendChild(s);const l=s.querySelector(".comment-close");l&&l.addEventListener("click",(()=>{if(s.querySelector(".confirm-box"))return;const r=document.createElement("div");r.className="confirm-box",r.innerHTML='\n          <span>Delete this comment?</span>\n          <div class="confirm-actions">\n            <button class="confirm-yes">Delete</button>\n            <button class="confirm-no">Cancel</button>\n          </div>\n        ',s.appendChild(r);const c=r.querySelector(".confirm-yes"),m=r.querySelector(".confirm-no");c&&"function"==typeof c.focus&&c.focus(),c.addEventListener("click",(()=>{const l=i.commentKey(e,t,n,a),c=JSON.parse(localStorage.getItem("deletedComments")||"[]");c.includes(l)||(c.push(l),localStorage.setItem("deletedComments",JSON.stringify(c))),s.classList.add("removing"),setTimeout((()=>{s&&s.parentNode&&s.parentNode.removeChild(s),"number"==typeof this.animes[e].comments&&this.animes[e].comments>0&&(this.animes[e].comments-=1,o.innerText=this.animes[e].comments),r&&r.parentNode&&r.parentNode.removeChild(r)}),320)})),m.addEventListener("click",(()=>{r&&r.parentNode&&r.parentNode.removeChild(r),l&&"function"==typeof l.focus&&l.focus()}))})),requestAnimationFrame((()=>{s.classList.add("enter"),requestAnimationFrame((()=>s.classList.add("show")))}))}async addNewComment(e){const t=document.getElementById("InputName"),n=document.getElementById("commentToPost"),i=document.getElementById("small");if(!t||!n)return;if(!t.value.trim()||!n.value.trim())return void(i&&i.classList.remove("hidden"));i&&i.classList.add("hidden");let s=document.getElementById("comments")||document.querySelector(".comments");s||(s=document.createElement("div"),s.id="comments",s.dataset.id=0,document.body.appendChild(s));const r=s.dataset.id,o=new Date,l=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0"),m=`${e}`;await(0,a.RV)(r,t.value,n.value,m),this.addComment(r,t.value,`${o.getFullYear()}-${l}-${c}`,n.value),t.value="",n.value=""}}}},e=>{e(e.s=561)}]);